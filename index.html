<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Firebase Chat</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
<script src='https://cdn.firebase.com/js/client/2.4.0/firebase.js'></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/2.3.0/firebaseui.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.3.0/firebaseui.css" />
   
</head>
<body>
    
        <button id="login">Login with Google</button><br />
        <input id="text" type="text" placeholder="Message"><br />
      
    
  <button id="post">Post</button><br/>
  <div id="results"></div>
  <script>
    var myFirebase = new Firebase('https://moosenim.firebaseio.com/');
 var usernameInput = document.querySelector('#username');
    var textInput = document.querySelector('#text');
    var postButton = document.querySelector('#post');
      var provider = new firebase.auth.GoogleAuthProvider();
      var username = null;
      var loginButton = document.querySelector('#login');
      postButton.style.display = "none";
      textInput.style.display = "none";

    postButton.addEventListener("click", function() {
        var msgUser = username;
      var msgText = textInput.value;
      myFirebase.push({username: msgUser, text: msgText});
      textInput.value = "";
    });

      /** Function to add a data listener **/
      var startListening = function () {
          myFirebase.on('child_added', function (snapshot) {
              var msg = snapshot.val();
              msgElement.className = "msg";
              document.getElementById("results").appendChild(msgElement);

              var msgUsernameElement = document.createElement("b");
              msgUsernameElement.textContent = msg.username;

              var msgTextElement = document.createElement("p");
              msgTextElement.textContent = msg.text;

              var msgElement = document.createElement("div");
              msgElement.appendChild(msgUsernameElement);
              msgElement.appendChild(msgTextElement);

              document.getElementById("results").appendChild(msgElement);
          });
      }

      firebase.auth().getRedirectResult().then(function (result) {
          if (result.credential) {
              // This gives you a Google Access Token. You can use it to access the Google API.
              var token = result.credential.accessToken;
              // ...
          }
          // The signed-in user info.
          var user = result.user;
      }).catch(function (error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // The email of the user's account used.
          var email = error.email;
          // The firebase.auth.AuthCredential type that was used.
          var credential = error.credential;
          // ...
      });

      // Begin listening for data
      startListening();
      loginButton.addEventListener("click", function () {
          firebase.auth().signInWithPopup(provider).then(function (result) {
              // This gives you a Google Access Token. You can use it to access the Google API.
              var token = result.credential.accessToken;
              // The signed-in user info.
              var user = result.user;
              // ...
          }).catch(function (error) {
              // Handle Errors here.
              var errorCode = error.code;
              var errorMessage = error.message;
              // The email of the user's account used.
              var email = error.email;
              // The firebase.auth.AuthCredential type that was used.
              var credential = error.credential;
              // ...
          });
          }, { remember: "none" }); // will end authentication on page close/reload
     
  </script>
</body>
</html>
